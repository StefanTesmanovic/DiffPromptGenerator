<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>Code Diff Prompt Generator</title>
    
    <!-- 1. Load the jsdiff library (JavaScript functionality) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.1.0/diff.min.js"></script>
    
    <!-- 2. Simplified CSS Styles -->
    <style>
        /* Use a simple, clean font stack */
        body {
            font-family: Arial, sans-serif;
            background-color: #f7fafc; /* light gray */
            color: #1a202c; /* dark gray */
            margin: 0;
            padding: 20px;
        }

        /* Center the main content */
        .container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        header {
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2em;
            color: #2d3748;
        }

        p {
            font-size: 1.1em;
            color: #4a5568;
        }

        

        /* Make each editor take up equal space */
        .editor-column {
            flex: 1;
            text-align: left;
        }


        /* Basic styling for textareas (removed box-shadow) */
        textarea {
            width: 100%;
            min-height: 400px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            padding: 10px;
            border: 1px solid #cbd5e0; /* gray border */
            border-radius: 8px;
            box-sizing: border-box; /* Important for width: 100% */
        }


        /* Basic button styling */
        button {
            background-color: #3182ce; /* blue */
            color: white;
            font-weight: bold;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }

        #submit-btn {
            float: right;
        }

        #generate-btn {
            display: none;
            float: right;
        }

        button:hover {
            background-color: #2b6cb0;
        }

        #modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        #modal-panel {
            background-color: #fefefe;
            margin: 50px auto; 
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        #close-btn {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
        }

        #close-btn:hover,
        #close-btn:focus {
            color: black;
        }
        
        .modal-content {
            padding: 20px;
            overflow-y: auto;
        }

        /* The <pre> tag for the prompt */
        #prompt-output {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f7fafc;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap; /*stops text from overflowing*/
            word-wrap: break-word; 
            text-align: left;
        }

        /* Modal Footer */
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e2e8f0;
            background-color: #f7fafc;
            text-align: right;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        
        #copy-btn {
            background-color: #4a5568; /* dark gray */
        }
        
        #copy-btn:hover {
            background-color: #2d3748; /* darker gray */
        }

    </style>
</head>
<body>

    <!-- We use simple class names that match our CSS styles -->
    <div class="container">
        <header>
            <h1>Code Diff Prompt Generator</h1>

            <label for="apiKey">Paste Your Google AI Studio Key:</label>
            <input type="password" id="apiKey" style="width: 100%;">
            <br><br>

            <p>Paste your original code, submit it, and edit it before generating a prompt.</p>
        </header>

        <div class="editor-column">
            <label id="label" for="original-code">Paste original code here</label>
            <button id="submit-btn">
                Submit code
            </button>
            <button id="generate-btn">
                Generate LLM Prompt
            </button>
            <textarea id="original-code" placeholder="Paste your original code here..."></textarea>
        </div>
    </div>

    <div id="modal">
        <div id="modal-panel">
            <div class="modal-header">
                <h2>Your LLM Prompt</h2>
                <button id="close-btn">&times;</button>
            </div>
            <div class="modal-content">
                <pre id="prompt-output"></pre>
            </div>
            <div class="modal-footer">
                <button id="copy-btn">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>
        const originalCodeEl = document.getElementById('original-code');
        const editedCodeEl = document.getElementById('edited-code');
        const generateBtn = document.getElementById('generate-btn');
        const modal = document.getElementById('modal');
        const modalPanel = document.getElementById('modal-panel');
        const closeBtn = document.getElementById('close-btn');
        const copyBtn = document.getElementById('copy-btn');
        const promptOutputEl = document.getElementById('prompt-output');
        const labela = document.getElementById('label');
        const submitBtn = document.getElementById('submit-btn');

        var originalCode = "";

        function showPrompt() {
            const originalText = originalCode;
            const editedText = originalCodeEl.value;
            
            const patch = Diff.createPatch('code', originalText, editedText);

            const promptTemplate = `
You are an expert code reviewer, known for concise and precise reviews. You work with exceptional engineers that understand instantly from concise bullet points.Your job is to analyze the code and inform about readability, complexity and differences to those two criteriums.

Here is the diff of the changes:

\`\`\`diff
${patch}
\`\`\`
`;          // I noticed that the model was responding with messages that are too 
            // long and waste time. Because of that I tried to shorten them and preserve 
            // information by informing the model of the environment and role instead of giving a word limit 

            promptOutputEl.textContent = promptTemplate.trim();
            modal.style.display = 'block';
        }

        function closeModal() {
            // Hide the modal (no animation)
            modal.style.display = 'none';
        }

        function copyToClipboard() {
            const textToCopy = promptOutputEl.textContent;

            // Create a temporary textarea element to hold the text
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            tempTextArea.style.position = 'absolute';
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);
            
            tempTextArea.select();
            
            try {
                // Use the older, more reliable execCommand
                document.execCommand('copy');
                // Give user feedback
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy to Clipboard';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
                copyBtn.textContent = 'Failed to Copy';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy to Clipboard';
                }, 2000);
            }
            
            // Clean up the temporary element
            document.body.removeChild(tempTextArea);
        }

        function handleSubmit() {
            labela.textContent = "Code submitted!";
            originalCode = originalCodeEl.value;
            submitBtn.style.display = 'none';
            generateBtn.style.display = 'unset';
        }

        generateBtn.addEventListener('click', showPrompt);
        closeBtn.addEventListener('click', closeModal);
        submitBtn.addEventListener('click', handleSubmit);
        
        copyBtn.addEventListener('click', copyToClipboard);

    </script>

</body>
</html>

